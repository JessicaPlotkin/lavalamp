<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    max-width: 1000px;
    padding: 100px;
    padding-top: 10px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h3 {
    font-family: 'Source Sans Pro', sans-serif;
  }
  .site-header {
    overflow: auto;
    height: 20vh;
    background-image: url(images/bgimage.jpg);
    background-size: cover;
  }
  .name-header {
    float: left;
    height: fit-content;
  }
  .name-header p {
    margin-top: 8%;
    margin-left: 5%;
    width: 30vw;
    font-style: normal;
    font-weight: bold;
    font-size: 35px;
    color: rgb(255, 255, 255);
    
    text-shadow: 0 0 4px cornflowerblue;
  }
  .title-bar {
    float: right;
    padding: 5px;
  }
  .title-bar a {
    display:block;
    float: left;
    text-align: center;
    text-decoration: none;
    font-style: normal;
    font-weight: 600;
    font-size: 18px;
    line-height: normal;
    color: rgb(219, 219, 219);
    padding: 16px;
    padding-top: 50px;
  }
</style>
<title>Lavalamp | CS 184</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>


<body>
    <div class="site-header">
        <div class="name-header">
            <p>Lavalamp Simulation</p>
        </div>
        <div class="title-bar"> 
            <a href="proposal.html">Proposal</a>
            <a href="index.html">Milestone</a>
            <a href="final.html">Final</a>
        </div>
    </div>

<!-- <h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2021</h1> -->
<div>
    <h1 align="middle">Final Report</h1>
    <h3 align="middle">Alyssa Lau, Jessica Plotkin, Jonathan Liu, and Zoe Zhang</h3>
</div>

<br><br>

    <div>

        <h2 align="middle">Abstract</h2>
        <dd align="justify">
            In this project, we built a 2D lava lamp simulator on ShaderToy from scratch. Our program attempts to simulate the movement patterns of the wax blobs and the various interactions between them. The wax objects in our simulation are represented using a system of metaballs, which allows for the smooth merging and divisions. To make our simulation more physically realistic, we utilize a temperature gradient to modify the size and speed of the wax blobs at different depths of the lava lamp. To make our simulation visually appealing and interesting, we created a variety of wax and background color combinations and wax effects. We also created a shaded version of the lava lamp using imaginary normals and a fake light source.        </dd>
    </br>
        <h2 align="middle">Technical Approach</h2>

        <h3 align="middle">Wax blobs</h3>

<br>
        <dd>
            \[ M = {r \over 0.8 * \sqrt{x^2 + y^2}} \]
        </dd>
<br>
        <dd>
            \[ E = {0.5 \over {{x^2 \over b^2} + {y^2 \over a^2}}} \]
        </dd>

        <h3 align="middle">Movements</h3>

        <dd align="justify">
        </dd>

        <dd align="justify">
            In Shadertoy, we set the color at each fragment at each time step for all the coordinates in the frame. As mentioned above, the basic movements of the wax blobs are based on sine and cosine functions of time.
        </dd>

        <h3 align="middle">Temperature effects</h3>

        <dd align="justify">  
            To make the simulation more realistic, we researched the temperature changes across different depths of a lava lamp. Considering the three different types of heat transfer within the lava lamp (convection, advection, and conduction), temperature and pressure determine the velocity and volume of a blob and is dependent on a blob’s distance from the wax pool.        </dd>   
        <br>
        <dd align="justify">
            There are several effects we created to simulate the influence of temperature on the lava lamp, including the temperature gradient of the background liquid, the volume of the blobs, and their movement. To demonstrate the temperature change across different depths in the lava lamp, we created a background color gradient that becomes warmer and lighter as the temperature increases. We researched how temperature and hydrostatic pressure affect the density and size of the wax blobs and utilized some insights from the thermocline of a larger body fluid, such as the ocean. Based on Gyure and Janosi's <a href="http://karman3.elte.hu/janosi/pdf_pub/PRE09lava-lamp.pdf">paper</a>, with trial and error, we found it most effective to scale the volumes and movements of the blobs using the following functions to represent the temperature and pressure change.        </dd>

        <br>
        <dd align="justify"> 
            We used
        </dd>
        <br>
        <dd>\[ radius Scale Factor = {({1 \over log(height + c) -k} )^ {1/3} * l} \] </dd>
            
            <dd align="justify">
                to simulate the impact of temperature and pressure, both of which are proportional to depth (and thus density). This determines the volume, which is proportional to the cubic of the radius.
                <em>c, k, l</em> are constants that can be adjusted based on the effects desired for our simulation. <em>height</em> is inversely proportional to depth and is calculated by the y component of each fragment coordinate divided by the y component of the resolution of the screen.

        </dd>
<br>
        <dd align="justify">
            We further adjusted the positions of the blobs at each time step by their respective depths to improve on the sine and cosine base functions we used on movements for more realistic simulation. We used        </dd>
<br>
        <dd>\[ p1 = {p0 + ({l \over log(height + c) -k} )^ 2} \] </dd>
        <dd align="justify">
            to simulate the impact of volume, pressure, and buoyant force that is proportional to volume (and thus velocity and density). While the blobs are within the wax pool, we set their initial speeds to be close to 0. Taking <em>v = u + at</em> , the final velocity is thus proportional to acceleration at any given time step. Again, <em>c, k, l</em> are adjustable parameters and <em>p0</em> is the base position at each time step after applying the sine and cosine function.
        </dd>

        <h3 align="middle">Shading</h3>
        <h3 align="middle">Problems & Lessons</h3>
        <dd align="justify">
            We encountered several challenges throughout this project. Initially, we wanted to use Navier Stokes equations for our simulation. After extensive research into this method and its visual effects, we felt it would not improve our simulation’s movements. Due to this, we pivoted to implementing separate features that would make our simulation more physically realistic, such as more realistic blobs shape, better movements, coloring, and shading.
        </dd>
        <br>
        <dd align="justify">
            When experimenting with the wax blobs’ movement, we originally tried Newton's polynomial interpolation and Hermite interpolation using points and derivatives of the functions, the graphs of which were provided in the paper. However, the polynomials we obtained from interpolation did not give us desirable outcomes. This was due to their high degrees and the difficulty to scale them for the frame used in Shadertoy. We then tried using logarithm functions adjusted by constants and found it sufficiently effective to mimic the behaviors of wax blobs in a real lava lamp.
        </dd>
        <br>
        <dd align="justify">
            Shadertoy was unexpectedly difficult and time-consuming to learn and work with, especially in the beginning. We started our program from scratch and found that there was little documentation and useful resources available online. Due to this, we spent a significant amount of time learning and experimenting with Shadertoy. Also, Shadertoy would occasionally go down for long periods of time (up to an entire day), which hindered our progress.
        </dd>
        <br>
        <dd align="justify">
        </dd>


        <h2 align="middle">Results</h2>

    </br>
        
        <h2 align="middle">References</h2>
        <dl>
            <dt>References:</dt>
            <dd>- <a href="http://www.subdude-site.com/WebPages_Local/RefInfo/Computer/Linux/LinuxGuidesOfOthers/linuxProgrammingGuides/pdfs/3Dogl/3D_3DLavaLampSimulation_report_ca2002_35pgs.pdf">A 3D Lava Lamp Simulation</a></dd>
            <dd>- <a href="https://www.researchgate.net/publication/220789344_Particle-Based_Fluid-Fluid_Interaction">Particle-Based Fluid-Fluid Interaction</a></dd>
            <dd>- <a href="https://graphics.stanford.edu/courses/cs348c-95-fall/projects/redkey_herman/writeup.html">A Particle System Representation of Candle Wax.</a></dd>
            <dd>- <a href="https://github.com/mharrys/fluids-2d?fbclid=IwAR2BkokLk1JW4ri9l-5nY8v8svZfWcqH7iyEfOZ5JpqtBVCplKhAv2ggsow">Fluids-2D</a></dd>
            <dd>- <a href="https://en.wikipedia.org/wiki/Navier–Stokes_equations">Navier–Stokes equations</a></dd>
            <dd>- <a href="http://karman3.elte.hu/janosi/pdf_pub/PRE09lava-lamp.pdf">Basics of a Lava Lamp convection</a></dd>
            <dd>- <a href="https://oceanservice.noaa.gov/facts/thermocline.html">What is a Thermocline?</a></dd>
            <dd>- <a href="http://wiki.geodynamics.umaine.edu/index.php/Heat_transfer">Heat Transfer in a Lava Lamp</a></dd>
            <dd>- <a href="https://www.youtube.com/channel/UCcAlTqd9zID6aNX3TzwxJXg/feed">Basic ShaderToy Tutorials</a></dd>
            <dd>- <a href="https://greentec.github.io/shadertoy-metaball-en/?fbclid=IwAR2O-2iOJFU2bQGV-A8jjGsLZJf00l1l1H4KuzBDAUfISnyRQUMUnuXk7b4">Metaball Analysis</a></dd>
            <dd>- <a href="https://www.shadertoy.com/view/WlKSWt">2D Shader Reference</a></dd>


        </br>
            <dt>Computing platform:</dt>
            <dd>- Personal Laptops</dd>
        </br>
            <dt>Software Resources</dt>
            <dd>- ShaderToy</dd>
        </dl>

        <h2 align="middle">Contributions</h2>

    </div></body>
</html>
